#cloud-config
final_message: "System boot (via cloud-init) is COMPLETE, after $UPTIME seconds. Finished at $TIMESTAMP"

users:
  - default

hostname: puppet
fqdn: puppet.lab.thewoodruffs.org

manage-resolv-conf: true

resolv_conf:
  nameservers: ['8.8.4.4', '8.8.8.8']
  searchdomains:
    - lab.thewoodruffs.org
    - openstacklocal
    - novalocal
  domain: lab.thewoodruffs.org
  options:
    rotate: true
    timeout: 1

write_files:
-  content: |
     DEVICE=eth1 
     BOOTPROTO=none 
     ONBOOT=yes 
     NETWORK=172.16.1.0
     NETMASK=255.255.255.0 
     IPADDR=172.16.1.2
     USERCTL=no
     MTU=1400
   path: /etc/sysconfig/network-scripts/ifcfg-eth1
-  content: |
     node 'oradb12.lab.thewoodruffs.org' {
       package { 'mysql':
         ensure => latest,
       }
     }
   path: /etc/puppetlabs/code/environments/production/manifests/site.pp
-  content: |
     -----BEGIN DSA PRIVATE KEY-----
     MIIBugIBAAKBgQDa2dnaauitZDAQOMr97hI0AF3smCe1WdypO5xOCMLyMK+lmufA
     hNENrZuqTNxW0HR4yNsFGfIm9xLCXSCg7kiHAlkf+QNlT9MPohRibBMq2Wx/GurK
     OiguA8H4MySsc2WGhg6kGbu0v9PqQmqIGtPIh4LW+/pNElSWY9NS/k2y9QIVAMx4
     74n+cLJcCkv85V7QqB+bzl/HAoGAIOBhYQEirpd+FI+NRoeveZ2UfgvzSl4xaT13
     RsVGCLKWRiIJ0jxxtrQBnbrOWVLGZ8Hagz79ZyFuQYoE4+Do2QLHqxMgHisQRGXP
     es5SDh4v4eLGIjoMe7aILpRL+GrJtwjTbqdzL9Jdydcsf5280Zw1VRuqdx3y+EeS
     r/lre8sCgYAqNJVEQqMbkttsOqMoGZv9/yb5j0gcRUa3TVmKOIF8lgYuYkSREy/L
     NK5FjvkkQRofQp+d7oXKfYyPZZ/25gldRCUguWTzRW+I9Jodo94U5u2qZ5IAoPZP
     v1OEG9PFZtM16dLbffENejAvRAckWa/3DKlk8upMDPBTyQLMh4F0CAIUIPbJlTUE
     0iQFJ5jmmI1Ciw/6Y1g=
     -----END DSA PRIVATE KEY-----
   path: /root/.ssh/id_dsa
   permissions: "0600"
-  content: |
     ssh-dss AAAAB3NzaC1kc3MAAACBANrZ2dpq6K1kMBA4yv3uEjQAXeyYJ7VZ3Kk7nE4IwvIwr6Wa58CE0Q2tm6pM3FbQdHjI2wUZ8ib3EsJdIKDuSIcCWR/5A2VP0w+iFGJsEyrZbH8a6so6KC4DwfgzJKxzZYaGDqQZu7S/0+pCaoga08iHgtb7+k0SVJZj01L+TbL1AAAAFQDMeO+J/nCyXApL/OVe0Kgfm85fxwAAAIAg4GFhASKul34Uj41Gh695nZR+C/NKXjFpPXdGxUYIspZGIgnSPHG2tAGdus5ZUsZnwdqDPv1nIW5BigTj4OjZAserEyAeKxBEZc96zlIOHi/h4sYiOgx7togulEv4asm3CNNup3Mv0l3J1yx/nbzRnDVVG6p3HfL4R5Kv+Wt7ywAAAIAqNJVEQqMbkttsOqMoGZv9/yb5j0gcRUa3TVmKOIF8lgYuYkSREy/LNK5FjvkkQRofQp+d7oXKfYyPZZ/25gldRCUguWTzRW+I9Jodo94U5u2qZ5IAoPZPv1OEG9PFZtM16dLbffENejAvRAckWa/3DKlk8upMDPBTyQLMh4F0CA== puppet
  path: /root/.ssh/id_dsa.pub
  permissions: "0600"

bootcmd:
  - cloud-init-per once hosts_puppet echo "172.16.1.2 puppet.lab.thewoodruffs.org puppet" >> /etc/hosts
  - cloud-init-per once hosts_oradb12 echo "172.16.1.3 oradb12.lab.thewoodruffs.org oradb12" >> /etc/hosts
  - cloud-init-per once puppet_repo yum -y install https://yum.puppetlabs.com/puppetlabs-release-pc1-el-6.noarch.rpm
  - cloud-init-per once puppetserver yum -y install puppetserver fuse-sshfs
  - cloud-init-per once ckhconfig_puppet chkconfig puppetserver on
  - cloud-init-per once iptables-off chkconfig iptables off
  - cloud-init-per once puppet_autosign echo "autosign = true" >> /etc/puppetlabs/puppet/puppet.conf
  - cloud-init-per once mkdircifs mkdir /mnt/software
  - cloud-init-per once updatefstab echo "brian@192.168.1.2:/Storage  /mnt/storage  fuse.sshfs  defaults,_netdev  0  0" >> /etc/fstab
  - cloud-init-per once reboot reboot
